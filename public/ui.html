<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Identity Vault Pro - Advanced Sovereign Identity Management</title>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --dark: #34495e;
      --light: #ecf0f1;
      --bg: #f8f9fa;
      --border: #dee2e6;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --gradient: linear-gradient(135deg, var(--secondary), var(--primary));
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--dark);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: var(--gradient);
      color: white;
      padding: 1rem 2rem;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .header-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Navigation */
    .nav-tabs {
      background: white;
      border-bottom: 1px solid var(--border);
      padding: 0 2rem;
      display: flex;
      overflow-x: auto;
    }

    .nav-tab {
      padding: 1rem 1.5rem;
      border: none;
      background: none;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .nav-tab:hover { background: #f8f9fa; }
    .nav-tab.active { border-bottom-color: var(--secondary); color: var(--secondary); }

    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Grid Layout */
    .grid { display: grid; gap: 2rem; }
    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); }
    .grid-3 { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); }

    /* Cards */
    .card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary);
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .form-textarea {
      height: 120px;
      resize: vertical;
      font-family: 'Fira Code', monospace;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      justify-content: center;
    }

    .btn-primary { background: var(--secondary); color: white; }
    .btn-primary:hover { background: #2980b9; transform: translateY(-1px); }

    .btn-success { background: var(--success); color: white; }
    .btn-success:hover { background: #229954; }

    .btn-danger { background: var(--danger); color: white; }
    .btn-danger:hover { background: #c0392b; }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--secondary);
      color: var(--secondary);
    }

    .btn-outline:hover {
      background: var(--secondary);
      color: white;
    }

    /* Advanced Controls */
    .toggle-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin: 1rem 0;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border-radius: 6px;
      transition: background 0.3s ease;
    }

    .toggle:hover { background: #f8f9fa; }

    .toggle input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--secondary);
    }

    /* Results Display */
    .result {
      margin-top: 1rem;
      border-radius: 8px;
      overflow: hidden;
    }

    .result-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .result-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .result-warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .result-content {
      padding: 1rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .result-json {
      font-family: 'Fira Code', monospace;
      font-size: 0.85rem;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Data Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .data-table th, .data-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .data-table th {
      background: #f8f9fa;
      font-weight: 600;
      position: sticky;
      top: 0;
    }

    .data-table tr:hover {
      background: #f8f9fa;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    /* Progress Bar */
    .progress {
      width: 100%;
      height: 8px;
      background: var(--light);
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-bar {
      height: 100%;
      background: var(--secondary);
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    /* Status Badges */
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-success { background: var(--success); color: white; }
    .badge-warning { background: var(--warning); color: white; }
    .badge-danger { background: var(--danger); color: white; }
    .badge-info { background: var(--secondary); color: white; }

    /* Advanced Filters */
    .filter-panel {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container { padding: 1rem; }
      .header { padding: 1rem; }
      .form-row { grid-template-columns: 1fr; }
      .nav-tab { padding: 0.75rem 1rem; }
    }

    /* Utilities */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .text-muted { color: #6c757d; }
    .mb-0 { margin-bottom: 0; }
    .mt-2 { margin-top: 1rem; }
    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--secondary);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Advanced Features */
    .json-editor {
      border: 2px solid var(--border);
      border-radius: 8px;
      font-family: 'Fira Code', monospace;
      font-size: 0.9rem;
      background: #f8f9fa;
    }

    .search-bar {
      position: relative;
    }

    .search-bar input {
      padding-right: 3rem;
    }

    .search-icon {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #6c757d;
    }

    .quick-actions {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .data-viz {
      height: 200px;
      background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-style: italic;
    }

    .notification {
      position: fixed;
      top: 80px;
      right: 1rem;
      background: white;
      border-left: 4px solid var(--success);
      border-radius: 8px;
      padding: 1rem;
      box-shadow: var(--shadow);
      z-index: 999;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.expanded {
      max-height: 1000px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div>
      <h1>🔐 Identity Vault Pro</h1>
      <small>Sovereign Identity Management & Agent Orchestration</small>
    </div>
    <div class="header-controls">
      <div class="status-indicator" title="System Status: Online"></div>
      <button id="settingsBtn" class="btn btn-outline">⚙️ Settings</button>
      <button id="exportBtn" class="btn btn-outline">📤 Export</button>
      <button id="logoutBtn" class="btn btn-danger">🚪 Logout</button>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-tabs">
    <button class="nav-tab active" data-tab="dashboard">📊 Dashboard</button>
    <button class="nav-tab" data-tab="profiles">👤 Profiles</button>
    <button class="nav-tab" data-tab="agents">🤖 Agents</button>
    <button class="nav-tab" data-tab="monitoring">📈 Monitoring</button>
    <button class="nav-tab" data-tab="integrations">🔌 Integrations</button>
    <button class="nav-tab" data-tab="security">🛡️ Security</button>
    <button class="nav-tab" data-tab="advanced">🔧 Advanced</button>
  </div>

  <div class="container">
    <!-- Authentication Modal -->
    <div id="authModal" class="modal">
      <div class="modal-content">
        <h2 class="text-center mb-2">🔐 Secure Access</h2>
        <p class="text-muted text-center">Enter your API token to access the Identity Vault</p>
        <form id="authForm">
          <div class="form-group">
            <label class="form-label">API Token</label>
            <input type="password" id="tokenInput" class="form-input" placeholder="Enter your secure token" required>
          </div>
          <div class="toggle">
            <input type="checkbox" id="rememberToken">
            <label for="rememberToken">Remember token (secure storage)</label>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
            🔓 Unlock Vault
          </button>
        </form>
      </div>
    </div>

    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content active">
      <div class="grid grid-3">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">System Overview</h3>
            <span class="badge badge-success">Online</span>
          </div>
          <div class="data-viz">Real-time Metrics Dashboard</div>
          <div id="systemStats" class="mt-2"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Recent Activity</h3>
            <button class="btn btn-outline" onclick="refreshActivity()">🔄 Refresh</button>
          </div>
          <div id="recentActivity">Loading activity...</div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Quick Actions</h3>
          </div>
          <div class="quick-actions" style="flex-direction: column;">
            <button class="btn btn-primary" onclick="showCreateProfile()">➕ New Profile</button>
            <button class="btn btn-success" onclick="showOrchestrate()">🚀 Orchestrate Agents</button>
            <button class="btn btn-outline" onclick="runHealthCheck()">🩺 Health Check</button>
            <button class="btn btn-outline" onclick="showBulkImport()">📥 Bulk Import</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Profiles Tab -->
    <div id="profiles" class="tab-content">
      <!-- Profile Search & Filters -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Profile Management</h3>
          <button class="btn btn-primary" onclick="showCreateProfile()">➕ Create Profile</button>
        </div>
        
        <div class="filter-panel">
          <div class="filter-grid">
            <div class="search-bar">
              <input type="text" id="profileSearch" class="form-input" placeholder="Search profiles...">
              <span class="search-icon">🔍</span>
            </div>
            <select id="profileTypeFilter" class="form-select">
              <option value="">All Types</option>
              <option value="user">Users</option>
              <option value="agent">Agents</option>
            </select>
            <select id="profileStatusFilter" class="form-select">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
            <button class="btn btn-outline" onclick="applyProfileFilters()">Apply Filters</button>
          </div>
        </div>

        <!-- Profile Creation Form -->
        <div id="createProfileForm" class="collapsible-content">
          <form id="profileForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Profile Type</label>
                <select id="profileType" class="form-select" onchange="updateProfileForm()">
                  <option value="user">User Profile</option>
                  <option value="agent">Agent Profile</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Profile ID</label>
                <input type="text" id="profileId" class="form-input" placeholder="unique_identifier" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label" id="nameLabel">Name</label>
                <input type="text" id="profileName" class="form-input" required>
              </div>
              <div class="form-group" id="roleGroup">
                <label class="form-label">Core Role</label>
                <input type="text" id="coreRole" class="form-input" placeholder="e.g., developer, analyst">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Profile Data (JSON)</label>
              <textarea id="profileData" class="form-textarea json-editor" placeholder='{"formality":"technical","depth":"maximum","step_by_step":true}'></textarea>
            </div>

            <div class="toggle-group">
              <div class="toggle">
                <input type="checkbox" id="pinIPFS">
                <label for="pinIPFS">📌 Pin to IPFS</label>
              </div>
              <div class="toggle">
                <input type="checkbox" id="enableZKP" onchange="toggleZKPFields()">
                <label for="enableZKP">🔐 Generate ZKP Proof</label>
              </div>
              <div class="toggle">
                <input type="checkbox" id="enableEncryption">
                <label for="enableEncryption">🔒 Encrypt Data</label>
              </div>
            </div>

            <div id="zkpFields" class="collapsible-content">
              <div class="form-group">
                <label class="form-label">ZKP Fields (comma-separated)</label>
                <input type="text" id="zkpFieldsList" class="form-input" placeholder="formality,depth,step_by_step">
              </div>
            </div>

            <div class="progress hidden" id="createProgress">
              <div class="progress-bar" style="width: 0%"></div>
            </div>

            <button type="submit" class="btn btn-success">🚀 Create Profile</button>
          </form>
        </div>

        <!-- Profile List -->
        <div id="profileList" class="mt-2"></div>
      </div>

      <!-- Profile Operations -->
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Load Profile</h3>
          </div>
          <form id="loadProfileForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Type</label>
                <select id="loadType" class="form-select">
                  <option value="user">User</option>
                  <option value="agent">Agent</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Profile ID</label>
                <input type="text" id="loadId" class="form-input" required>
              </div>
            </div>

            <div class="toggle-group">
              <div class="toggle">
                <input type="checkbox" id="includeState" checked>
                <label for="includeState">Include State</label>
              </div>
              <div class="toggle">
                <input type="checkbox" id="includeLogs">
                <label for="includeLogs">Include Logs</label>
              </div>
              <div class="toggle">
                <input type="checkbox" id="zkpProof">
                <label for="zkpProof">Generate ZKP Proof</label>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Safe Word (optional)</label>
                <input type="text" id="safeWord" class="form-input" placeholder="pause">
              </div>
              <div class="form-group">
                <label class="form-label">Redact Fields (optional)</label>
                <input type="text" id="redactFields" class="form-input" placeholder="pii,sensitive">
              </div>
            </div>

            <button type="submit" class="btn btn-primary">📥 Load Profile</button>
          </form>
          <div id="loadProfileResult" class="result"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Update Profile</h3>
          </div>
          <form id="updateProfileForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Type</label>
                <select id="updateType" class="form-select">
                  <option value="user">User</option>
                  <option value="agent">Agent</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Profile ID</label>
                <input type="text" id="updateId" class="form-input" required>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Field Path</label>
              <input type="text" id="updateField" class="form-input" placeholder="interaction_preferences.depth" required>
            </div>

            <div class="form-group">
              <label class="form-label">New Value</label>
              <input type="text" id="updateValue" class="form-input" required>
            </div>

            <button type="submit" class="btn btn-success">💾 Update Profile</button>
          </form>
          <div id="updateProfileResult" class="result"></div>
        </div>
      </div>
    </div>

    <!-- Agents Tab -->
    <div id="agents" class="tab-content">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Agent Orchestration</h3>
          </div>
          <form id="orchestrateForm">
            <div class="form-group">
              <label class="form-label">Team ID</label>
              <input type="text" id="teamId" class="form-input" placeholder="project_alpha" required>
            </div>

            <div class="form-group">
              <label class="form-label">Agents Configuration (JSON)</label>
              <textarea id="agentsConfig" class="form-textarea json-editor" placeholder='[{"agent_id":"coder_v1","role":"developer"},{"agent_id":"reviewer_v1","role":"tester"}]'></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">Tasks (JSON Array)</label>
              <textarea id="tasksConfig" class="form-textarea" placeholder='["code review","test MVP","deploy to staging"]'></textarea>
            </div>

            <div class="toggle-group">
              <div class="toggle">
                <input type="checkbox" id="parallelExecution">
                <label for="parallelExecution">🔄 Parallel Execution</label>
              </div>
              <div class="toggle">
                <input type="checkbox" id="autoRecover">
                <label for="autoRecover">🛡️ Auto Recovery</label>
              </div>
            </div>

            <button type="submit" class="btn btn-success">🚀 Start Orchestration</button>
          </form>
          <div id="orchestrateResult" class="result"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Agent Audit Trail</h3>
          </div>
          <form id="auditForm">
            <div class="form-group">
              <label class="form-label">Team ID</label>
              <input type="text" id="auditTeamId" class="form-input" required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Limit</label>
                <input type="number" id="auditLimit" class="form-input" value="100" min="1">
              </div>
              <div class="form-group">
                <label class="form-label">Since Date</label>
                <input type="date" id="auditSince" class="form-input">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Filter Agents (comma-separated)</label>
              <input type="text" id="auditAgents" class="form-input" placeholder="agent_id1,agent_id2">
            </div>

            <button type="submit" class="btn btn-primary">📊 Get Audit Trail</button>
          </form>
          <div id="auditResult" class="result"></div>
        </div>
      </div>
    </div>

    <!-- Monitoring Tab -->
    <div id="monitoring" class="tab-content">
      <div class="grid grid-3">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">System Health</h3>
          </div>
          <div id="healthMetrics">
            <div class="data-viz">Performance Monitoring</div>
          </div>
          <button class="btn btn-outline mt-2" onclick="runHealthCheck()">🩺 Run Health Check</button>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Session State & Logs</h3>
          </div>
          <form id="stateForm">
            <div class="form-group">
              <label class="form-label">Profile ID</label>
              <input type="text" id="stateId" class="form-input" required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Limit</label>
                <input type="number" id="stateLimit" class="form-input" value="50" min="1">
              </div>
              <div class="form-group">
                <label class="form-label">Log Type</label>
                <select id="stateType" class="form-select">
                  <option value="">All Types</option>
                  <option value="drift">Drift</option>
                  <option value="feedback">Feedback</option>
                  <option value="error">Errors</option>
                </select>
              </div>
            </div>

            <button type="submit" class="btn btn-primary">📊 Get State & Logs</button>
          </form>
          <div id="stateResult" class="result"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Feedback Management</h3>
          </div>
          <form id="feedbackForm">
            <div class="form-group">
              <label class="form-label">Profile ID</label>
              <input type="text" id="feedbackProfileId" class="form-input" required>
            </div>

            <div class="form-group">
              <label class="form-label">Feedback Type</label>
              <select id="feedbackType" class="form-select">
                <option value="feedback">General Feedback</option>
                <option value="drift">Drift Detection</option>
                <option value="contradiction">Contradiction</option>
                <option value="optimization">Optimization</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Feedback Data (JSON)</label>
              <textarea id="feedbackData" class="form-textarea json-editor" placeholder='{"note":"Performance improvement","severity":"medium","suggestions":["optimize queries"]}'></textarea>
            </div>

            <button type="submit" class="btn btn-success">💬 Submit Feedback</button>
          </form>
          <div id="feedbackResult" class="result"></div>
        </div>
      </div>
    </div>

    <!-- Integrations Tab -->
    <div id="integrations" class="tab-content">
      <div class="grid grid-3">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">LangChain Integration</h3>
          </div>
          <form id="langchainForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Profile ID</label>
                <input type="text" id="lcProfileId" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Type</label>
                <select id="lcType" class="form-select">
                  <option value="user">User</option>
                  <option value="agent">Agent</option>
                </select>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">🔗 Generate Loader</button>
          </form>
          <div id="langchainResult" class="result"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">AutoGen Configuration</h3>
          </div>
          <form id="autogenForm">
            <div class="form-group">
              <label class="form-label">Agent ID</label>
              <input type="text" id="autogenAgentId" class="form-input" required>
            </div>
            <button type="submit" class="btn btn-primary">⚙️ Get Config</button>
          </form>
          <div id="autogenResult" class="result"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">RAG Integration</h3>
          </div>
          <form id="ragForm">
            <div class="form-group">
              <label class="form-label">Query</label>
              <input type="text" id="ragQuery" class="form-input" placeholder="Search query" required>
            </div>
            <div class="form-group">
              <label class="form-label">Profile ID</label>
              <input type="text" id="ragProfileId" class="form-input" required>
            </div>
            <button type="submit" class="btn btn-primary">🔍 RAG Filter</button>
          </form>
          <div id="ragResult" class="result"></div>
        </div>
      </div>
    </div>

    <!-- Security Tab -->
    <div id="security" class="tab-content">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Security Overview</h3>
          </div>
          <div class="data-viz">Security Metrics & Threat Analysis</div>
          <div class="quick-actions mt-2">
            <button class="btn btn-primary" onclick="generateSecurityReport()">📋 Security Report</button>
            <button class="btn btn-warning" onclick="rotateKeys()">🔐 Rotate Keys</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Access Control</h3>
          </div>
          <div id="accessControlList"></div>
          <button class="btn btn-outline mt-2" onclick="refreshAccessControl()">🔄 Refresh</button>
        </div>
      </div>
    </div>

    <!-- Advanced Tab -->
    <div id="advanced" class="tab-content">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Bulk Operations</h3>
          </div>
          <div class="quick-actions">
            <button class="btn btn-primary" onclick="showBulkImport()">📥 Bulk Import</button>
            <button class="btn btn-outline" onclick="showBulkExport()">📤 Bulk Export</button>
            <button class="btn btn-warning" onclick="showBulkDelete()">🗑️ Bulk Delete</button>
          </div>
          <div id="bulkOperationResult" class="result"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">System Administration</h3>
          </div>
          <div class="quick-actions">
            <button class="btn btn-success" onclick="backupSystem()">💾 Create Backup</button>
            <button class="btn btn-warning" onclick="restoreSystem()">🔄 Restore System</button>
            <button class="btn btn-danger" onclick="resetSystem()">⚠️ Reset System</button>
          </div>
          <div id="adminResult" class="result"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">API Testing & Development</h3>
        </div>
        <form id="apiTestForm">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">HTTP Method</label>
              <select id="apiMethod" class="form-select">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PATCH">PATCH</option>
                <option value="DELETE">DELETE</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Endpoint</label>
              <input type="text" id="apiEndpoint" class="form-input" placeholder="/profiles/user/test_id" required>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Request Body (JSON)</label>
            <textarea id="apiBody" class="form-textarea json-editor" placeholder='{"key": "value"}'></textarea>
          </div>
          
          <button type="submit" class="btn btn-primary">🚀 Send Request</button>
        </form>
        <div id="apiTestResult" class="result"></div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification">
    <div id="notificationContent"></div>
  </div>

  <script>
    // Global variables
    const API_BASE = '/';
    let TOKEN = localStorage.getItem('vault_token') || '';
    let currentTab = 'dashboard';

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    function initializeApp() {
      // Check authentication
      if (!TOKEN) {
        showAuthModal();
      } else {
        hideAuthModal();
        loadDashboard();
      }

      // Setup event listeners
      setupEventListeners();
    }

    function setupEventListeners() {
      // Auth form
      document.getElementById('authForm').addEventListener('submit', handleAuth);
      
      // Tab navigation
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', (e) => switchTab(e.target.dataset.tab));
      });

      // Form submissions
      document.getElementById('profileForm').addEventListener('submit', handleCreateProfile);
      document.getElementById('loadProfileForm').addEventListener('submit', handleLoadProfile);
      document.getElementById('updateProfileForm').addEventListener('submit', handleUpdateProfile);
      document.getElementById('orchestrateForm').addEventListener('submit', handleOrchestrate);
      document.getElementById('auditForm').addEventListener('submit', handleAudit);
      document.getElementById('stateForm').addEventListener('submit', handleGetState);
      document.getElementById('feedbackForm').addEventListener('submit', handleFeedback);
      document.getElementById('langchainForm').addEventListener('submit', handleLangChain);
      document.getElementById('autogenForm').addEventListener('submit', handleAutoGen);
      document.getElementById('ragForm').addEventListener('submit', handleRAG);
      document.getElementById('apiTestForm').addEventListener('submit', handleAPITest);

      // Other controls
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    }

    // Authentication
    function handleAuth(e) {
      e.preventDefault();
      TOKEN = document.getElementById('tokenInput').value;
      const remember = document.getElementById('rememberToken').checked;
      
      if (remember) {
        localStorage.setItem('vault_token', TOKEN);
      }
      
      hideAuthModal();
      loadDashboard();
      showNotification('Authentication successful!', 'success');
    }

    function showAuthModal() {
      document.getElementById('authModal').classList.remove('hidden');
    }

    function hideAuthModal() {
      document.getElementById('authModal').classList.add('hidden');
    }

    function handleLogout() {
      TOKEN = '';
      localStorage.removeItem('vault_token');
      showAuthModal();
      showNotification('Logged out successfully', 'info');
    }

    // Tab management
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName).classList.add('active');

      currentTab = tabName;

      // Load tab-specific data
      switch(tabName) {
        case 'dashboard':
          loadDashboard();
          break;
        case 'profiles':
          loadProfileList();
          break;
        case 'monitoring':
          loadMonitoringData();
          break;
      }
    }

    // API utilities
    async function apiRequest(endpoint, options = {}) {
      showLoading(options.loadingElement);
      
      const config = {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${TOKEN}`,
          ...options.headers
        },
        ...options
      };

      try {
        const response = await fetch(API_BASE + endpoint, config);
        let data;
        
        try {
          data = await response.json();
        } catch {
          data = await response.text();
        }

        hideLoading(options.loadingElement);

        if (response.ok) {
          return { success: true, data };
        } else {
          return { success: false, error: data.error || data, status: response.status };
        }
      } catch (error) {
        hideLoading(options.loadingElement);
        return { success: false, error: error.message };
      }
    }

    function displayResult(elementId, result, isJson = false) {
      const element = document.getElementById(elementId);
      if (!element) return;

      element.innerHTML = '';
      
      const resultDiv = document.createElement('div');
      resultDiv.className = `result-content ${result.success ? 'result-success' : 'result-error'}`;
      
      if (isJson && result.success) {
        const pre = document.createElement('pre');
        pre.className = 'result-json';
        pre.textContent = JSON.stringify(result.data, null, 2);
        resultDiv.appendChild(pre);
      } else {
        resultDiv.textContent = result.success ? 
          (typeof result.data === 'string' ? result.data : JSON.stringify(result.data, null, 2)) :
          `Error: ${result.error}`;
      }
      
      element.appendChild(resultDiv);
    }

    // Dashboard
    async function loadDashboard() {
      try {
        // Load system stats
        const healthResult = await apiRequest('health');
        if (healthResult.success) {
          document.getElementById('systemStats').innerHTML = `
            <div class="badge badge-success">Status: ${healthResult.data.status}</div>
            <div class="text-muted mt-2">Version: ${healthResult.data.version || 'N/A'}</div>
            <div class="text-muted">Uptime: ${healthResult.data.timestamp ? 'Online' : 'N/A'}</div>
          `;
        }

        // Load recent activity (mock for now)
        document.getElementById('recentActivity').innerHTML = `
          <div class="mb-2">✅ Profile created: user_001</div>
          <div class="mb-2">🤖 Agent orchestrated: team_alpha</div>
          <div class="mb-2">📊 Health check completed</div>
          <div class="text-muted">Last updated: ${new Date().toLocaleTimeString()}</div>
        `;
      } catch (error) {
        console.error('Dashboard load error:', error);
      }
    }

    // Profile management
    function showCreateProfile() {
      switchTab('profiles');
      toggleCollapsible('createProfileForm');
    }

    function updateProfileForm() {
      const type = document.getElementById('profileType').value;
      const isAgent = type === 'agent';
      
      document.getElementById('nameLabel').textContent = isAgent ? 'Agent Name' : 'Canonical Name';
      document.getElementById('roleGroup').style.display = isAgent ? 'block' : 'none';
    }

    function toggleZKPFields() {
      const enabled = document.getElementById('enableZKP').checked;
      toggleCollapsible('zkpFields', enabled);
    }

    async function handleCreateProfile(e) {
      e.preventDefault();
      
      const type = document.getElementById('profileType').value;
      const id = document.getElementById('profileId').value;
      const name = document.getElementById('profileName').value;
      const role = document.getElementById('coreRole').value;
      
      let data = {};
      try {
        const dataStr = document.getElementById('profileData').value;
        if (dataStr) data = JSON.parse(dataStr);
      } catch (error) {
        showNotification('Invalid JSON in profile data', 'error');
        return;
      }

      const profile = {
        [type === 'user' ? 'user_id' : 'agent_id']: id,
        ...(type === 'user' ? { canonical_name: name } : { name, core_role: role }),
        ...data
      };

      if (document.getElementById('pinIPFS').checked) {
        profile.pinToIPFS = true;
      }

      if (document.getElementById('enableZKP').checked) {
        const zkpFields = document.getElementById('zkpFieldsList').value;
        if (zkpFields) {
          profile.zkpFields = zkpFields.split(',').map(f => f.trim());
        }
      }

      showProgress('createProgress', 0);
      
      const result = await apiRequest(`profiles/${type}`, {
        method: 'POST',
        body: JSON.stringify(profile)
      });

      showProgress('createProgress', 100);
      
      if (result.success) {
        showNotification(`${type} profile created successfully!`, 'success');
        document.getElementById('profileForm').reset();
        loadProfileList();
      } else {
        showNotification(`Failed to create profile: ${result.error}`, 'error');
      }

      hideProgress('createProgress');
    }

    async function handleLoadProfile(e) {
      e.preventDefault();
      
      const type = document.getElementById('loadType').value;
      const id = document.getElementById('loadId').value;
      
      const params = new URLSearchParams({
        includeState: document.getElementById('includeState').checked,
        includeLogs: document.getElementById('includeLogs').checked
      });

      if (document.getElementById('zkpProof').checked) {
        params.append('zkpProof', 'true');
      }

      const safeWord = document.getElementById('safeWord').value;
      if (safeWord) params.append('safe_word', safeWord);

      const redact = document.getElementById('redactFields').value;
      if (redact) params.append('redact', redact);

      const result = await apiRequest(`profiles/${type}/${id}?${params}`);
      displayResult('loadProfileResult', result, true);
    }

    async function handleUpdateProfile(e) {
      e.preventDefault();
      
      const type = document.getElementById('updateType').value;
      const id = document.getElementById('updateId').value;
      const field = document.getElementById('updateField').value;
      const value = document.getElementById('updateValue').value;

      const result = await apiRequest(`profiles/${type}/${id}`, {
        method: 'PATCH',
        body: JSON.stringify({ [field]: value })
      });

      displayResult('updateProfileResult', result);
      
      if (result.success) {
        showNotification('Profile updated successfully!', 'success');
      }
    }

    async function loadProfileList() {
      // This would typically load from an endpoint that lists profiles
      // For now, we'll show a placeholder
      document.getElementById('profileList').innerHTML = `
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Type</th>
              <th>Name</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>user_001</td>
              <td><span class="badge badge-info">User</span></td>
              <td>John Doe</td>
              <td><span class="badge badge-success">Active</span></td>
              <td>
                <button class="btn btn-outline" onclick="loadProfile('user', 'user_001')">Load</button>
                <button class="btn btn-outline" onclick="editProfile('user', 'user_001')">Edit</button>
              </td>
            </tr>
          </tbody>
        </table>
      `;
    }

    // Agent operations
    async function handleOrchestrate(e) {
      e.preventDefault();
      
      const teamId = document.getElementById('teamId').value;
      
      let agents = [];
      try {
        const agentsStr = document.getElementById('agentsConfig').value;
        if (agentsStr) agents = JSON.parse(agentsStr);
      } catch (error) {
        showNotification('Invalid JSON in agents configuration', 'error');
        return;
      }

      let tasks = [];
      try {
        const tasksStr = document.getElementById('tasksConfig').value;
        if (tasksStr) tasks = JSON.parse(tasksStr);
      } catch (error) {
        showNotification('Invalid JSON in tasks configuration', 'error');
        return;
      }

      const config = { teamId, agents, tasks };

      if (document.getElementById('parallelExecution').checked) {
        config.parallel = true;
      }

      if (document.getElementById('autoRecover').checked) {
        config.autoRecover = true;
      }

      const result = await apiRequest('agents/orchestrate', {
        method: 'POST',
        body: JSON.stringify(config)
      });

      displayResult('orchestrateResult', result, true);
      
      if (result.success) {
        showNotification('Agent orchestration started!', 'success');
      }
    }

    async function handleAudit(e) {
      e.preventDefault();
      
      const teamId = document.getElementById('auditTeamId').value;
      const params = new URLSearchParams({
        limit: document.getElementById('auditLimit').value
      });

      const since = document.getElementById('auditSince').value;
      if (since) params.append('since', since);

      const agents = document.getElementById('auditAgents').value;
      if (agents) params.append('agents', agents);

      const result = await apiRequest(`agents/audit/${teamId}?${params}`);
      displayResult('auditResult', result, true);
    }

    // Monitoring
    async function handleGetState(e) {
      e.preventDefault();
      
      const id = document.getElementById('stateId').value;
      const params = new URLSearchParams({
        limit: document.getElementById('stateLimit').value
      });

      const type = document.getElementById('stateType').value;
      if (type) params.append('type', type);

      const result = await apiRequest(`state/${id}?${params}`);
      displayResult('stateResult', result, true);
    }

    async function handleFeedback(e) {
      e.preventDefault();
      
      const profileId = document.getElementById('feedbackProfileId').value;
      const type = document.getElementById('feedbackType').value;
      
      let data = {};
      try {
        const dataStr = document.getElementById('feedbackData').value;
        if (dataStr) data = JSON.parse(dataStr);
      } catch (error) {
        showNotification('Invalid JSON in feedback data', 'error');
        return;
      }

      const result = await apiRequest('feedback', {
        method: 'POST',
        body: JSON.stringify({ profile_id: profileId, type, data })
      });

      displayResult('feedbackResult', result);
      
      if (result.success) {
        showNotification('Feedback submitted successfully!', 'success');
      }
    }

    function loadMonitoringData() {
      // Load real-time monitoring data
      document.getElementById('healthMetrics').innerHTML = `
        <div class="data-viz">
          <div>CPU Usage: 45%</div>
          <div>Memory: 2.3GB / 8GB</div>
          <div>Active Profiles: 127</div>
          <div>API Requests/min: 342</div>
        </div>
      `;
    }

    // Integration handlers
    async function handleLangChain(e) {
      e.preventDefault();
      
      const profileId = document.getElementById('lcProfileId').value;
      const type = document.getElementById('lcType').value;

      const result = await apiRequest('integrations/langchain', {
        method: 'POST',
        body: JSON.stringify({ profileId, type })
      });

      displayResult('langchainResult', result, true);
    }

    async function handleAutoGen(e) {
      e.preventDefault();
      
      const agentId = document.getElementById('autogenAgentId').value;

      const result = await apiRequest('integrations/autogen', {
        method: 'POST',
        body: JSON.stringify({ agentId })
      });

      displayResult('autogenResult', result, true);
    }

    async function handleRAG(e) {
      e.preventDefault();
      
      const query = document.getElementById('ragQuery').value;
      const profileId = document.getElementById('ragProfileId').value;

      const result = await apiRequest('integrations/rag', {
        method: 'POST',
        body: JSON.stringify({ query, profileId })
      });

      displayResult('ragResult', result, true);
    }

    // API Testing
    async function handleAPITest(e) {
      e.preventDefault();
      
      const method = document.getElementById('apiMethod').value;
      const endpoint = document.getElementById('apiEndpoint').value;
      const bodyStr = document.getElementById('apiBody').value;

      let body = null;
      if (bodyStr && (method === 'POST' || method === 'PATCH')) {
        try {
          body = JSON.stringify(JSON.parse(bodyStr));
        } catch (error) {
          showNotification('Invalid JSON in request body', 'error');
          return;
        }
      }

      const result = await apiRequest(endpoint.startsWith('/') ? endpoint.slice(1) : endpoint, {
        method,
        ...(body && { body })
      });

      displayResult('apiTestResult', result, true);
    }

    // Utility functions
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const content = document.getElementById('notificationContent');
      
      content.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 4000);
    }

    function showLoading(elementId) {
      if (elementId) {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML = '<div class="spinner"></div>';
        }
      }
    }

    function hideLoading(elementId) {
      if (elementId) {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML = '';
        }
      }
    }

    function showProgress(elementId, percentage) {
      const element = document.getElementById(elementId);
      if (element) {
        element.classList.remove('hidden');
        const bar = element.querySelector('.progress-bar');
        if (bar) {
          bar.style.width = `${percentage}%`;
        }
      }
    }

    function hideProgress(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        element.classList.add('hidden');
      }
    }

    function toggleCollapsible(elementId, force = null) {
      const element = document.getElementById(elementId);
      if (element) {
        const shouldExpand = force !== null ? force : !element.classList.contains('expanded');
        if (shouldExpand) {
          element.classList.add('expanded');
        } else {
          element.classList.remove('expanded');
        }
      }
    }

    // Advanced operations
    async function runHealthCheck() {
      const result = await apiRequest('health');
      showNotification(
        result.success ? 'Health check passed!' : `Health check failed: ${result.error}`,
        result.success ? 'success' : 'error'
      );
    }

    function showBulkImport() {
      showNotification('Bulk import functionality coming soon!', 'info');
    }

    function showBulkExport() {
      showNotification('Bulk export functionality coming soon!', 'info');
    }

    function showOrchestrate() {
      switchTab('agents');
    }

    function refreshActivity() {
      loadDashboard();
      showNotification('Activity refreshed!', 'success');
    }

    // Additional utility functions for advanced features
    function generateSecurityReport() {
      showNotification('Security report generated!', 'success');
    }

    function rotateKeys() {
      if (confirm('Are you sure you want to rotate encryption keys? This may affect existing encrypted data.')) {
        showNotification('Key rotation initiated...', 'warning');
      }
    }

    function refreshAccessControl() {
      showNotification('Access control list refreshed!', 'success');
    }

    function backupSystem() {
      showNotification('System backup initiated...', 'info');
    }

    function restoreSystem() {
      if (confirm('Are you sure you want to restore the system? This will overwrite current data.')) {
        showNotification('System restore initiated...', 'warning');
      }
    }

    function resetSystem() {
      if (confirm('Are you sure you want to reset the system? This will delete all data permanently.')) {
        showNotification('System reset initiated...', 'danger');
      }
    }
  </script>
</body>
</html>
